SELECT * WHERE {
 {
	SERVICE <http://9.12.235.45:9091/openrdf-sesame/repositories/bjdiag-rdf> {
		SELECT ?date (AVG(?value) AS ?avgval) WHERE {
	  		?x <http://www.ibm.com/health/bjdiag/PM25TBL#DATE> ?date;
	    	  <http://www.ibm.com/health/bjdiag/PM25TBL#VALUE> ?value
	    } GROUP BY ?date
	} 
}
OPTIONAL {
	SERVICE <http://9.12.235.45:9091/openrdf-sesame/repositories/bjdiag-rdf> {
		SELECT ?date2 ?diag_code (COUNT(DISTINCT ?empi) AS ?opcnt) WHERE {
		        ?x <http://www.ibm.com/health/bjdiag/DIAG_OUTPATIENT#EMPI> ?empi ;
				    <http://www.ibm.com/health/bjdiag/DIAG_OUTPATIENT#DATE> ?date2 ;
					<http://www.ibm.com/health/bjdiag/DIAG_OUTPATIENT#DIAG_NAME> ?diag_code
		    FILTER (?diag_code = "胸闷" 
			 || ?diag_code = "胸痛"
			 || ?diag_code = "肺部感染" )
			} GROUP BY ?date2 ?diag_code
	    } 
	} FILTER (?date = ?date2)
} limit 6
