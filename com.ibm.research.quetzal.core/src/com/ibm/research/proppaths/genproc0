CREATE  OR REPLACE PROCEDURE GENPROC0 (IN STMT1 VARCHAR(10240), IN STMT2 VARCHAR(10240), IN STMT3 VARCHAR(10240), IN LEVEL INTEGER DEFAULT 1)
	DYNAMIC RESULT SETS 1
P1: BEGIN
	DECLARE LOOPS INTEGER;
	DECLARE CNT INTEGER;
	DECLARE RCNT INTEGER;
	DECLARE C1 CURSOR WITH RETURN FOR S1;

	IF LEVEL = -1 THEN
		SET LOOPS = 65536;
	ELSE
		SET LOOPS = LEVEL;
	END IF;
	
 	DECLARE GLOBAL TEMPORARY TABLE SESSION.TEMP(VAL BIGINT, LEVEL INTEGER) IN USERTEMP1 ON COMMIT DELETE ROWS WITH REPLACE NOT LOGGED;
   
   
    
    EXECUTE IMMEDIATE STMT1;

	GET DIAGNOSTICS RCNT = ROW_COUNT;		 		
	SET CNT = 1;
	WHILE (CNT <= LOOPS AND RCNT > 0) DO
		
    	PREPARE S2 FROM STMT2;
    	EXECUTE S2 USING CNT - 1, CNT;
		
		GET DIAGNOSTICS RCNT = ROW_COUNT;		 		
		SET CNT = CNT + 1;
	END WHILE;
	
	PREPARE S1 FROM STMT3;
	OPEN C1;
END P1 